<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed Big Chungus</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background-color: #87CEEB; }
        
        /* Stats UI */
        #ui-container {
            position: absolute;
            top: 20px; left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border: 3px solid #fff;
            min-width: 240px;
            user-select: none;
            z-index: 10;
        }

        h1 { margin: 0 0 10px 0; font-size: 24px; color: #333; text-align: center; }

        .stat-row {
            display: flex; justify-content: space-between;
            font-size: 18px; margin-bottom: 8px; font-weight: bold;
            border-bottom: 1px solid #eee; padding-bottom: 5px;
        }
        .value { color: #e67e22; font-family: monospace; font-size: 20px; }

        /* Reset Button */
        #reset-btn {
            width: 100%;
            background-color: #ff4757;
            color: white;
            border: none;
            padding: 10px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.2s;
        }
        #reset-btn:hover { background-color: #e84118; }
        #reset-btn:active { transform: translateY(2px); }
        
        /* Instructions */
        #instructions {
            position: absolute; bottom: 30px; width: 100%;
            text-align: center; color: white; font-weight: bold; font-size: 24px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); pointer-events: none;
        }

        /* Security Block Overlay */
        #drop-zone {
            display: none; 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); color: white; z-index: 50;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        #drop-zone.active { display: flex; }
        .drop-box {
            border: 4px dashed #fff; padding: 40px; border-radius: 20px;
            background: rgba(255,255,255,0.1);
        }
    </style>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="ui-container">
        <h1>üê∞ Chungus Stats</h1>
        <div class="stat-row"><span>üçî Hamburburs:</span><span class="value" id="burger-count">0</span></div>
        <div class="stat-row"><span>‚öñÔ∏è Weight:</span><span class="value"><span id="weight-count">140</span> lbs</span></div>
        <button id="reset-btn">RESET GAME</button>
    </div>

    <div id="instructions">DRAG THE HAMBURBUR TO FEED HIM</div>

    <div id="drop-zone">
        <div class="drop-box">
            <h1>‚ö†Ô∏è Security Blocked Auto-Load</h1>
            <p>If not on GitHub Pages, drag 'bunny.stl' here.</p>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { STLLoader } from 'three/addons/loaders/STLLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- Game Setup ---
        let burgersEaten = 0;
        let weight = 140; 
        let currentScale = 1.0; 
        
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); 

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(0, 10, 25);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(10, 30, 20); dirLight.castShadow = true; scene.add(dirLight);

        // Floor
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(500, 500), new THREE.MeshStandardMaterial({ color: 0x7cfc00 }));
        floor.rotation.x = -Math.PI / 2; floor.receiveShadow = true; scene.add(floor);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 5, 0);

        // --- THE BUNNY ---
        let bunnyMesh;
        const loader = new STLLoader();

        function processGeometry(geometry) {
            if(bunnyMesh) scene.remove(bunnyMesh);
            
            // COLOR CHANGE: 0xD3D3D3 is a "Chungus Grey"
            const material = new THREE.MeshStandardMaterial({ 
                color: 0xD3D3D3, 
                roughness: 0.5,
                metalness: 0.1
            });

            geometry.center(); 
            geometry.rotateX(-Math.PI / 2);
            
            // Normalize Height to 10
            geometry.computeBoundingBox();
            const h = geometry.boundingBox.max.y - geometry.boundingBox.min.y;
            const s = 10 / h;
            geometry.scale(s, s, s);
            
            // Place on floor
            geometry.computeBoundingBox();
            geometry.translate(0, -geometry.boundingBox.min.y, 0);

            bunnyMesh = new THREE.Mesh(geometry, material);
            bunnyMesh.castShadow = true; bunnyMesh.receiveShadow = true;
            
            scene.add(bunnyMesh);
            document.getElementById('drop-zone').classList.remove('active');
        }

        // Try load
        loader.load('./bunny.stl', (geo) => processGeometry(geo), undefined, 
            () => { document.getElementById('drop-zone').classList.add('active'); });

        // Fallback Drag/Drop
        window.addEventListener('dragover', (e) => e.preventDefault());
        window.addEventListener('drop', (e) => {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            if(file) { loader.load(URL.createObjectURL(file), (geo) => processGeometry(geo)); }
        });

        // --- THE HAMBURBUR ---
        let hamburbur;
        const burgerStartPos = new THREE.Vector3(8, 0.25, 8); 

        function createHamburbur() {
            const burgerGroup = new THREE.Group();
            const bunMat = new THREE.MeshStandardMaterial({ color: 0xE6A55C }); 
            const botBun = new THREE.Mesh(new THREE.CylinderGeometry(1.4, 1.4, 0.5, 32), bunMat);
            const meatMat = new THREE.MeshStandardMaterial({ color: 0x5c2b0e }); 
            const patty = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 1.5, 0.4, 32), meatMat);
            patty.position.y = 0.5;
            const leafMat = new THREE.MeshStandardMaterial({ color: 0x4CAF50 });
            const lettuce = new THREE.Mesh(new THREE.CylinderGeometry(1.55, 1.55, 0.1, 32), leafMat);
            lettuce.position.y = 0.8;
            const topBun = new THREE.Mesh(new THREE.SphereGeometry(1.4, 32, 16, 0, Math.PI * 2, 0, Math.PI/2), bunMat);
            topBun.position.y = 0.85;

            burgerGroup.add(botBun, patty, lettuce, topBun);
            burgerGroup.position.copy(burgerStartPos);
            burgerGroup.castShadow = true;
            scene.add(burgerGroup);
            return burgerGroup;
        }

        hamburbur = createHamburbur();

        // --- RESET LOGIC ---
        document.getElementById('reset-btn').addEventListener('click', () => {
            // Reset Variables
            burgersEaten = 0;
            weight = 140;
            currentScale = 1.0;

            // Reset UI
            document.getElementById('burger-count').innerText = 0;
            document.getElementById('weight-count').innerText = 140;

            // Reset Visuals
            if(bunnyMesh) bunnyMesh.scale.set(1, 1, 1);
            resetBurger();
        });

        // --- DRAG LOGIC ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const dragPlane = new THREE.Plane();
        const dragOffset = new THREE.Vector3();
        let isDragging = false;

        function getIntersects(event, object) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            return raycaster.intersectObject(object, true); 
        }

        window.addEventListener('mousedown', (event) => {
            const intersects = getIntersects(event, hamburbur);
            if (intersects.length > 0) {
                isDragging = true;
                controls.enabled = false; 
                const intersectPoint = intersects[0].point;
                dragPlane.setFromNormalAndCoplanarPoint(camera.getWorldDirection(dragPlane.normal), intersectPoint);
                dragOffset.copy(intersectPoint).sub(hamburbur.position);
            }
        });

        window.addEventListener('mousemove', (event) => {
            if (!isDragging) return;
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersectPoint = new THREE.Vector3();
            raycaster.ray.intersectPlane(dragPlane, intersectPoint);

            if (intersectPoint) {
                hamburbur.position.copy(intersectPoint).sub(dragOffset);
                if (hamburbur.position.y < 0.25) hamburbur.position.y = 0.25;
            }
        });

        window.addEventListener('mouseup', () => {
            if (!isDragging) return;
            isDragging = false;
            controls.enabled = true;

            if (bunnyMesh) {
                const dist = hamburbur.position.distanceTo(bunnyMesh.position);
                if (dist < 9.0 * currentScale) {
                    feedBunny();
                } else {
                    resetBurger();
                }
            } else {
                resetBurger();
            }
        });

        function resetBurger() {
            hamburbur.position.copy(burgerStartPos);
        }

        function feedBunny() {
            // Audio
            const ctx = new (window.AudioContext||window.webkitAudioContext)();
            const osc = ctx.createOscillator(); const g = ctx.createGain();
            osc.frequency.setValueAtTime(150, ctx.currentTime);
            osc.frequency.linearRampToValueAtTime(40, ctx.currentTime+0.15);
            g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime+0.15);
            osc.connect(g); g.connect(ctx.destination); osc.start(); osc.stop(ctx.currentTime+0.2);

            // Update Logic
            burgersEaten++;
            weight += 5; // Increased to 5lbs per burger so you notice it!
            currentScale *= 1.02;

            // Update UI
            document.getElementById('burger-count').innerText = burgersEaten;
            document.getElementById('weight-count').innerText = Math.floor(weight);

            // Visual Update
            bunnyMesh.scale.set(currentScale, currentScale, currentScale);
            resetBurger();
        }

        function animate() { 
            requestAnimationFrame(animate); 
            controls.update(); 
            if (!isDragging) hamburbur.rotation.y += 0.01;
            renderer.render(scene, camera); 
        }
        animate();

        window.addEventListener('resize', () => { 
            camera.aspect = window.innerWidth/window.innerHeight; 
            camera.updateProjectionMatrix(); 
            renderer.setSize(window.innerWidth, window.innerHeight); 
        });
    </script>
</body>
</html>